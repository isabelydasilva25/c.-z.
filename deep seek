// Array para simular o banco de dados (remova quando conectar ao backend real)
let clientes = [];

async function incluirCliente() {
    const form = document.getElementById('formCliente');
    if (!form.checkValidity()) {
        alert("Por favor, preencha todos os campos corretamente.");
        return;
    }

    const cliente = {
        codigo: document.getElementById('codigo').value,
        nome: document.getElementById('nome').value,
        idade: document.getElementById('idade').value,
        telefone: document.getElementById('telefone').value,
        emergencia: document.getElementById('emergencia').value,
        email: document.getElementById('email').value,
        cpf: document.getElementById('cpf').value,
        endereco: document.getElementById('endereco').value
    };

    try {
        // Simulação - substitua pelo fetch real
        clientes.push(cliente);
        alert("Cliente cadastrado com sucesso!");
        limparFormulario();
        
        /* Versão com fetch (descomente quando tiver o backend)
        const response = await fetch('/clientes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(cliente)
        });

        if (response.ok) {
            alert("Cliente cadastrado com sucesso!");
            limparFormulario();
        } else {
            alert("Erro ao cadastrar cliente.");
        }
        */
    } catch (err) {
        console.error("Erro:", err);
        alert("Erro ao cadastrar cliente.");
    }
}

function excluirCliente() {
    const codigo = document.getElementById('codigo').value;
    if (!codigo) {
        alert("Por favor, informe o código do cliente a ser excluído.");
        return;
    }

    // Simulação - substitua pelo fetch real
    const index = clientes.findIndex(c => c.codigo === codigo);
    if (index !== -1) {
        clientes.splice(index, 1);
        alert("Cliente excluído com sucesso!");
        limparFormulario();
    } else {
        alert("Cliente não encontrado!");
    }
    
    /* Versão com fetch (descomente quando tiver o backend)
    try {
        const response = await fetch(`/clientes/${codigo}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            alert("Cliente excluído com sucesso!");
            limparFormulario();
        } else {
            alert("Erro ao excluir cliente.");
        }
    } catch (err) {
        console.error("Erro:", err);
        alert("Erro ao excluir cliente.");
    }
    */
}

async function alterarCliente() {
    const codigo = document.getElementById('codigo').value;
    if (!codigo) {
        alert("Por favor, informe o código do cliente a ser alterado.");
        return;
    }

    const clienteAtualizado = {
        codigo: codigo,
        nome: document.getElementById('nome').value,
        idade: document.getElementById('idade').value,
        telefone: document.getElementById('telefone').value,
        emergencia: document.getElementById('emergencia').value,
        email: document.getElementById('email').value,
        cpf: document.getElementById('cpf').value,
        endereco: document.getElementById('endereco').value
    };

    // Simulação - substitua pelo fetch real
    const index = clientes.findIndex(c => c.codigo === codigo);
    if (index !== -1) {
        clientes[index] = clienteAtualizado;
        alert("Cliente atualizado com sucesso!");
    } else {
        alert("Cliente não encontrado!");
    }
    
    /* Versão com fetch (descomente quando tiver o backend)
    try {
        const response = await fetch(`/clientes/${codigo}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(clienteAtualizado)
        });
        
        if (response.ok) {
            alert("Cliente atualizado com sucesso!");
        } else {
            alert("Erro ao atualizar cliente.");
        }
    } catch (err) {
        console.error("Erro:", err);
        alert("Erro ao atualizar cliente.");
    }
    */
}

function consultarClientes() {
    // Alternar entre as seções
    document.querySelector('main > div').style.display = 'none';
    document.getElementById('lista-clientes').style.display = 'block';
    
    // Preencher a tabela com dados simulados
    const tabela = document.querySelector('#tabela-clientes tbody');
    tabela.innerHTML = '';
    
    if (clientes.length === 0) {
        tabela.innerHTML = '<tr><td colspan="6">Nenhum cliente cadastrado.</td></tr>';
    } else {
        clientes.forEach(cliente => {
            const linha = document.createElement('tr');
            linha.innerHTML = `
                <td>${cliente.codigo}</td>
                <td>${cliente.nome}</td>
                <td>${cliente.idade}</td>
                <td>${cliente.telefone}</td>
                <td>${cliente.cpf}</td>
                <td>
                    <button onclick="carregarCliente('${cliente.codigo}')">Editar</button>
                    <button onclick="excluirClienteLista('${cliente.codigo}')">Excluir</button>
                </td>
            `;
            tabela.appendChild(linha);
        });
    }
    
    /* Versão com fetch (descomente quando tiver o backend)
    try {
        const response = await fetch('/clientes');
        const clientes = await response.json();
        
        // Preencher a tabela com dados reais...
        
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao carregar clientes.');
    }
    */
}

function voltarParaCadastro() {
    document.querySelector('main > div').style.display = 'block';
    document.getElementById('lista-clientes').style.display = 'none';
}

function limparFormulario() {
    document.getElementById('formCliente').reset();
}

// Funções auxiliares para a tabela (simuladas)
function carregarCliente(codigo) {
    const cliente = clientes.find(c => c.codigo === codigo);
    if (cliente) {
        document.getElementById('codigo').value = cliente.codigo;
        document.getElementById('nome').value = cliente.nome;
        document.getElementById('idade').value = cliente.idade;
        document.getElementById('telefone').value = cliente.telefone;
        document.getElementById('emergencia').value = cliente.emergencia;
        document.getElementById('email').value = cliente.email;
        document.getElementById('cpf').value = cliente.cpf;
        document.getElementById('endereco').value = cliente.endereco;
        
        voltarParaCadastro();
    }
}

function excluirClienteLista(codigo) {
    if (confirm(`Deseja realmente excluir o cliente ${codigo}?`)) {
        const index = clientes.findIndex(c => c.codigo === codigo);
        if (index !== -1) {
            clientes.splice(index, 1);
            consultarClientes(); // Atualiza a tabela
        }
    }
}
